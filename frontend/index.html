<form id="loginForm" onsubmit="handleLogin(event)">
    <div>
        <label for="email">Email:</label>
        <input type="email" id="email" name="email" required>
    </div>
    <div>
        <label for="password">Password:</label>
        <input type="password" id="password" name="password" required>
    </div>
    <div>
        <button type="submit" id="loginBtn">Login</button>
        <div id="loginLoading" style="display:none;">Loading...</div>
    </div>
</form>

<script>
async function handleLogin(event) {
    event.preventDefault();
    
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    const loginBtn = document.getElementById('loginBtn');
    const loginLoading = document.getElementById('loginLoading');
    const loginForm = document.getElementById('loginForm');
    
    try {
        // Show loading state
        loginBtn.disabled = true;
        loginLoading.style.display = 'flex';
        
        console.log('Attempting login for:', email); // Debug log
        
        const response = await fetch(`${API_URL}/api/login`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
                'Accept': 'application/json'
            },
            body: `username=${encodeURIComponent(email)}&password=${encodeURIComponent(password)}`
        });

        const data = await response.json();
        console.log('Login response:', data); // Debug log

        if (!response.ok) {
            throw new Error(data.detail || 'Login failed');
        }
        
        // Verify user type matches
        if (data.user.user_type !== currentUserType) {
            throw new Error(`Please login with a ${currentUserType} account`);
        }
        
        // Store token and user data
        localStorage.setItem('token', data.access_token);
        localStorage.setItem('user', JSON.stringify(data.user));

        console.log('Login successful, redirecting...'); // Debug log

        // Redirect based on user type
        if (currentUserType === 'student') {
            window.location.href = 'profile-portal.html';
        } else {
            window.location.href = 'recruiter-dashboard.html';
        }
    } catch (error) {
        console.error('Login error:', error);
        showError(error.message || 'Invalid email or password');
        event.target.reset(); // Use this instead of loginForm.reset()
    } finally {
        // Hide loading state
        loginBtn.disabled = false;
        loginLoading.style.display = 'none';
    }
}
</script>

<!-- Start the server -->
<script>
    const { exec } = require('child_process');
    exec('python -m http.server 8000', (error, stdout, stderr) => {
        if (error) {
            console.error(`Error starting server: ${error.message}`);
            return;
        }
        if (stderr) {
            console.error(`Server stderr: ${stderr}`);
            return;
        }
        console.log(`Server stdout: ${stdout}`);
    });
</script>