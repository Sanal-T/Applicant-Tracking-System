<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recruiter Profile - SmartRecruit</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2563eb;
            --primary-hover: #1d4ed8;
            --secondary-color: #64748b;
            --success-color: #22c55e;
            --success-light: #dcfce7;
            --warning-color: #f59e0b;
            --warning-light: #fef3c7;
            --error-color: #ef4444;
            --error-light: #fee2e2;
            --background-color: #f8fafc;
            --card-background: #ffffff;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border-color: #e2e8f0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-primary);
            line-height: 1.5;
        }

        .navbar {
            background-color: var(--card-background);
            padding: 1rem 2rem;
            box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .navbar-brand {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            text-decoration: none;
        }

        .navbar-menu {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .navbar-menu a {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.2s;
        }

        .navbar-menu a:hover {
            color: var(--primary-color);
        }

        .navbar-menu a.active {
            color: var(--primary-color);
        }

        .user-menu {
            position: relative;
            display: inline-block;
        }

        .user-menu-button {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .user-menu-content {
            display: none;
            position: absolute;
            right: 0;
            background-color: var(--card-background);
            min-width: 200px;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            border-radius: 0.5rem;
            padding: 0.5rem;
            z-index: 1000;
        }

        .user-menu-content.show {
            display: block;
        }

        .user-menu-item {
            display: block;
            padding: 0.5rem 1rem;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: 0.25rem;
            cursor: pointer;
        }

        .user-menu-item:hover {
            background-color: var(--background-color);
            color: var(--primary-color);
        }

        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        .page-header {
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .page-header h1 {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .profile-grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 2rem;
        }

        .profile-sidebar {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .profile-card, .section-card {
            background-color: var(--card-background);
            border-radius: 0.5rem;
            padding: 1.5rem;
            box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1);
        }

        .profile-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .profile-avatar {
            width: 128px;
            height: 128px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .profile-name {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .profile-title {
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .profile-company {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .profile-contact {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .contact-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            color: var(--text-secondary);
        }

        .contact-label {
            font-weight: 500;
            min-width: 80px;
        }

        .contact-value {
            color: var(--text-primary);
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .stat-card {
            background-color: var(--background-color);
            padding: 1.5rem;
            border-radius: 0.5rem;
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--text-secondary);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            font-size: 1rem;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .tab-navigation {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 1.5rem;
        }

        .tab-button {
            padding: 0.75rem 1.5rem;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            font-weight: 500;
            color: var(--text-secondary);
            cursor: pointer;
        }

        .tab-button.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .button-group {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }

        .button {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .primary-button {
            background-color: var(--primary-color);
            color: white;
        }

        .primary-button:hover {
            background-color: var(--primary-hover);
        }

        .secondary-button {
            background-color: var(--background-color);
            color: var(--text-primary);
        }

        .secondary-button:hover {
            background-color: var(--border-color);
        }

        .alert {
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 0.5rem;
            text-align: center;
        }

        .alert-success {
            background-color: var(--success-light);
            color: #166534;
        }

        .alert-error {
            background-color: var(--error-light);
            color: #991b1b;
        }

        #messageContainer {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            min-width: 300px;
        }

        #messageContainer .alert {
            animation: slideIn 0.3s ease-out forwards, slideOut 0.3s ease-in forwards 3s;
        }

        @keyframes slideIn {
            from {
                transform: translateX(-50%) translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
            to {
                transform: translateX(-50%) translateY(-100%);
                opacity: 0;
            }
        }

        @media (max-width: 768px) {
            .navbar {
                padding: 1rem;
            }

            .navbar-menu {
                display: none;
            }

            .container {
                padding: 0 1rem;
            }

            .profile-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .button-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <a href="recruiter-dashboard.html" class="navbar-brand">SmartRecruit</a>
        <div class="navbar-menu">
            <a href="recruiter-dashboard.html">Dashboard</a>
            <a href="posted-jobs.html">Posted Jobs</a>
            <a href="applications-dashboard.html">Applications</a>
            <a href="recruiter-profile.html" class="active">Profile</a>
        </div>
        <div class="user-menu">
            <button class="user-menu-button" onclick="toggleUserMenu()">
                <span id="userName">Loading...</span>
                <span>▼</span>
            </button>
            <div id="userMenuContent" class="user-menu-content">
                <div class="user-menu-item" onclick="window.location.href='recruiter-profile.html'">Profile</div>
                <div class="user-menu-item" onclick="showSettings()">Settings</div>
                <div class="user-menu-item" onclick="window.location.href='student-profile.html?demo=true'">View Demo Student Profile</div>
                <div class="user-menu-item" onclick="logout()">Logout</div>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="container">
        <!-- Page Header -->
        <div class="page-header">
            <h1>My Profile</h1>
        </div>

        <!-- Profile Content -->
        <div class="profile-grid">
            <!-- Profile Sidebar -->
            <div class="profile-sidebar">
                <!-- Profile Info Card -->
                <div class="profile-card">
                    <div class="profile-header">
                        <div class="profile-avatar" id="profileAvatar">DR</div>
                        <h2 class="profile-name" id="profileName">Demo Recruiter</h2>
                        <div class="profile-title" id="profileTitle">Technical Recruiter</div>
                        <div class="profile-company" id="profileCompany">TechCorp Solutions</div>
                    </div>
                    <div class="profile-contact">
                        <div class="contact-item">
                            <span class="contact-label">Email:</span>
                            <span class="contact-value" id="profileEmail">demo.recruiter@example.com</span>
                        </div>
                        <div class="contact-item">
                            <span class="contact-label">Phone:</span>
                            <span class="contact-value" id="profilePhone">(555) 123-4567</span>
                        </div>
                        <div class="contact-item">
                            <span class="contact-label">Location:</span>
                            <span class="contact-value" id="profileLocation">San Francisco, CA</span>
                        </div>
                    </div>
                </div>

                <!-- Recruitment Stats Card -->
                <div class="profile-card">
                    <h3 class="section-title">Recruitment Stats</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="jobsPostedStat">5</div>
                            <div class="stat-label">Jobs Posted</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="applicationsReceivedStat">42</div>
                            <div class="stat-label">Applications</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="hiresStat">2</div>
                            <div class="stat-label">Hires</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Profile Main Content -->
            <div class="profile-main">
                <!-- Tab Navigation -->
                <div class="section-card">
                    <div class="tab-navigation">
                        <button class="tab-button active" onclick="showTab('profile')">Profile Information</button>
                        <button class="tab-button" onclick="showTab('account')">Account Settings</button>
                        <button class="tab-button" onclick="showTab('notifications')">Notifications</button>
                    </div>

                    <!-- Profile Information Tab -->
                    <div id="profileTab" class="tab-content active">
                        <form id="profileForm">
                            <div class="form-group">
                                <label for="fullName" class="form-label">Full Name</label>
                                <input type="text" id="fullName" name="fullName" class="form-input" placeholder="Your full name">
                            </div>
                            <div class="form-group">
                                <label for="jobTitle" class="form-label">Job Title</label>
                                <input type="text" id="jobTitle" name="jobTitle" class="form-input" placeholder="Your job title">
                            </div>
                            <div class="form-group">
                                <label for="company" class="form-label">Company</label>
                                <input type="text" id="company" name="company" class="form-input" placeholder="Your company name">
                            </div>
                            <div class="form-group">
                                <label for="email" class="form-label">Email</label>
                                <input type="email" id="email" name="email" class="form-input" placeholder="Your email address">
                            </div>
                            <div class="form-group">
                                <label for="phone" class="form-label">Phone</label>
                                <input type="tel" id="phone" name="phone" class="form-input" placeholder="Your phone number">
                            </div>
                            <div class="form-group">
                                <label for="location" class="form-label">Location</label>
                                <input type="text" id="location" name="location" class="form-input" placeholder="Your location">
                            </div>
                            <div class="form-group">
                                <label for="bio" class="form-label">Bio</label>
                                <textarea id="bio" name="bio" class="form-input form-textarea" placeholder="Write a short bio about yourself..."></textarea>
                            </div>
                            <div class="button-group">
                                <button type="button" class="button primary-button" onclick="saveProfile()">Save Changes</button>
                                <button type="button" class="button secondary-button" onclick="resetForm()">Cancel</button>
                            </div>
                        </form>
                    </div>

                    <!-- Account Settings Tab -->
                    <div id="accountTab" class="tab-content">
                        <form id="accountForm">
                            <div class="form-group">
                                <label for="currentPassword" class="form-label">Current Password</label>
                                <input type="password" id="currentPassword" name="currentPassword" class="form-input" placeholder="Enter your current password">
                            </div>
                            <div class="form-group">
                                <label for="newPassword" class="form-label">New Password</label>
                                <input type="password" id="newPassword" name="newPassword" class="form-input" placeholder="Enter a new password">
                            </div>
                            <div class="form-group">
                                <label for="confirmPassword" class="form-label">Confirm New Password</label>
                                <input type="password" id="confirmPassword" name="confirmPassword" class="form-input" placeholder="Confirm your new password">
                            </div>
                            <div class="button-group">
                                <button type="button" class="button primary-button" onclick="changePassword()">Update Password</button>
                                <button type="button" class="button secondary-button" onclick="resetPasswordForm()">Cancel</button>
                            </div>
                        </form>
                    </div>

                    <!-- Notifications Tab -->
                    <div id="notificationsTab" class="tab-content">
                        <form id="notificationsForm">
                            <div class="form-group">
                                <label class="form-label">Email Notifications</label>
                                <div style="margin-top: 0.5rem;">
                                    <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                                        <input type="checkbox" id="notifyApplications" name="notifyApplications" checked>
                                        <label for="notifyApplications" style="margin-left: 0.5rem;">New job applications</label>
                                    </div>
                                    <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                                        <input type="checkbox" id="notifyMessages" name="notifyMessages" checked>
                                        <label for="notifyMessages" style="margin-left: 0.5rem;">Messages from candidates</label>
                                    </div>
                                    <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                                        <input type="checkbox" id="notifyUpdates" name="notifyUpdates" checked>
                                        <label for="notifyUpdates" style="margin-left: 0.5rem;">Platform updates and news</label>
                                    </div>
                                </div>
                            </div>
                            <div class="button-group">
                                <button type="button" class="button primary-button" onclick="saveNotifications()">Save Preferences</button>
                                <button type="button" class="button secondary-button" onclick="resetNotificationsForm()">Reset</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Message container for alerts -->
    <div id="messageContainer"></div>

    <!-- Load DomPurify library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/2.3.3/purify.min.js"></script>

    <script>
        // Utility function to create and display alerts
        function showAlert(message, type = 'success') {
            const messageContainer = document.getElementById('messageContainer');
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.textContent = message;

            messageContainer.appendChild(alertDiv);

            setTimeout(() => {
                alertDiv.remove();
            }, 3000);
        }

        // Utility function to sanitize HTML
        function sanitizeHTML(html) {
            return DOMPurify.sanitize(html);
        }

        // Securely get data from cookies
        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
            return null;
        }

        // Check authentication
        function checkAuth() {
            // Try getting token from both cookie and localStorage for compatibility
            let token = getCookie('token');
            if (!token) {
                token = localStorage.getItem('token');
            }
            
            let user = localStorage.getItem('user');

            if (user) {
                // Parse the JSON data
                user = JSON.parse(user);
                if (!token || !user || user.user_type !== 'recruiter') {
                    // If in demo mode, load demo profile instead of redirecting
                    if (window.location.search.includes('demo=true')) {
                        loadDemoProfile();
                        return;
                    }
                    window.location.href = 'index.html';
                    return;
                }

                // Update UI with user data
                document.getElementById('userName').textContent = sanitizeHTML(user.full_name);
                
                // Load profile data
                loadRecruiterProfile();
                return;
            }
            else {
                // If in demo mode, load demo profile instead of redirecting
                if (window.location.search.includes('demo=true')) {
                    loadDemoProfile();
                    return;
                }
                // No localstorage user. Redirect
                window.location.href = 'index.html';
            }
        }

        // Load demo profile
        function loadDemoProfile() {
            const demoUser = {
                id: 1001,
                full_name: "Demo Recruiter",
                email: "demo.recruiter@example.com",
                user_type: "recruiter",
                company: "TechCorp Solutions",
                phone: "(555) 123-4567",
                location: "San Francisco, CA",
                job_title: "Technical Recruiter",
                bio: "Experienced technical recruiter specializing in identifying and attracting top tech talent across various domains including software development, data science, and DevOps."
            };
            
            // Update UI with demo user data
            document.getElementById('userName').textContent = sanitizeHTML(demoUser.full_name);
            
            // Store demo user in localStorage
            localStorage.setItem('user', JSON.stringify(demoUser));
            
            // Show a demo mode notification
            showAlert('Running in demo mode', 'success');

            // Display profile data
            displayProfileData(demoUser);
            loadRecruitmentStats();
        }

        // Load recruiter profile
        async function loadRecruiterProfile() {
            try {
                // In a real app, fetch profile from API
                const user = JSON.parse(localStorage.getItem('user'));
                
                // If we have user data in localStorage
                if (user) {
                    // Display the data we have
                    displayProfileData(user);
                    
                    // Try to fetch additional data from API
                    const response = await fetch(`http://localhost:8000/api/recruiters/profile`, {
                        headers: {
                            'Authorization': `Bearer ${getCookie('token') || localStorage.getItem('token')}`
                        }
                    });

                    if (response.ok) {
                        const profileData = await response.json();
                        // Update with additional data from API
                        displayProfileData({...user, ...profileData});
                    }
                }
                
                // Load recruitment statistics
                loadRecruitmentStats();
            } catch (error) {
                console.error('Error loading profile:', error);
                // If API fails, use what we have or fallback to demo
                const user = JSON.parse(localStorage.getItem('user'));
                if (user) {
                    displayProfileData(user);
                } else {
                    loadDemoProfile();
                }
                loadRecruitmentStats();
            }
        }

        // Load recruitment statistics
        async function loadRecruitmentStats() {
            try {
                // In a real app, fetch stats from API
                const response = await fetch(`http://localhost:8000/api/recruiters/stats`, {
                    headers: {
                        'Authorization': `Bearer ${getCookie('token') || localStorage.getItem('token')}`
                    }
                });

                if (response.ok) {
                    const stats = await response.json();
                    updateRecruitmentStats(stats);
                } else {
                    // If API fails, load demo stats
                    loadDemoStats();
                }
            } catch (error) {
                console.error('Error loading stats:', error);
                loadDemoStats();
            }
        }

        // Load demo statistics
        function loadDemoStats() {
            const demoStats = {
                jobs_posted: 5,
                applications_received: 42,
                hires_made: 2
            };
            updateRecruitmentStats(demoStats);
        }

        // Update recruitment statistics in UI
        function updateRecruitmentStats(stats) {
            document.getElementById('jobsPostedStat').textContent = stats.jobs_posted || 0;
            document.getElementById('applicationsReceivedStat').textContent = stats.applications_received || 0;
            document.getElementById('hiresStat').textContent = stats.hires_made || 0;
        }

        // Display profile data in the UI
        function displayProfileData(user) {
            // Basic info section
            if (user.full_name) {
                document.getElementById('profileName').textContent = sanitizeHTML(user.full_name);
            }
            
            if (user.job_title) {
                document.getElementById('profileTitle').textContent = sanitizeHTML(user.job_title);
            }
            
            if (user.company) {
                document.getElementById('profileCompany').textContent = sanitizeHTML(user.company);
            }
            
            if (user.email) {
                document.getElementById('profileEmail').textContent = sanitizeHTML(user.email);
            }
            
            if (user.phone) {
                document.getElementById('profilePhone').textContent = sanitizeHTML(user.phone);
            }
            
            if (user.location) {
                document.getElementById('profileLocation').textContent = sanitizeHTML(user.location);
            }
            
            // Set avatar initials
            if (user.full_name) {
                const nameParts = user.full_name.split(' ');
                const initials = nameParts.length > 1 
                    ? `${nameParts[0].charAt(0)}${nameParts[1].charAt(0)}`
                    : nameParts[0].charAt(0);
                document.getElementById('profileAvatar').textContent = initials;
            }
            
            // Form fields
            document.getElementById('fullName').value = user.full_name || '';
            document.getElementById('jobTitle').value = user.job_title || '';
            document.getElementById('company').value = user.company || '';
            document.getElementById('email').value = user.email || '';
            document.getElementById('phone').value = user.phone || '';
            document.getElementById('location').value = user.location || '';
            document.getElementById('bio').value = user.bio || '';
        }

        // Toggle user menu
        function toggleUserMenu() {
            const menu = document.getElementById('userMenuContent');
            menu.classList.toggle('show');
        }

        // Close user menu when clicking outside
        window.addEventListener('click', function(event) {
            const menu = document.getElementById('userMenuContent');
            const button = document.querySelector('.user-menu-button');

            if (!menu.contains(event.target) && !button.contains(event.target)) {
                menu.classList.remove('show');
            }
        });

        // Show specific tab
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all tab buttons
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            
            // Show selected tab
            const tabId = tabName + 'Tab';
            document.getElementById(tabId).classList.add('active');
            
            // Highlight active tab button
            const buttons = document.querySelectorAll('.tab-button');
            buttons.forEach(button => {
                if (button.textContent.toLowerCase().includes(tabName.toLowerCase())) {
                    button.classList.add('active');
                }
            });
        }

        // Save profile changes
        async function saveProfile() {
            const formData = {
                full_name: document.getElementById('fullName').value,
                job_title: document.getElementById('jobTitle').value,
                company: document.getElementById('company').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                location: document.getElementById('location').value,
                bio: document.getElementById('bio').value
            };
            
            try {
                // In a real app, send data to API
                const response = await fetch('http://localhost:8000/api/recruiters/profile', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${getCookie('token') || localStorage.getItem('token')}`
                    },
                    body: JSON.stringify(formData)
                });
                
                if (!response.ok) {
                    throw new Error('Failed to update profile');
                }
                
                // Update localStorage user
                const currentUser = JSON.parse(localStorage.getItem('user') || '{}');
                localStorage.setItem('user', JSON.stringify({
                    ...currentUser,
                    ...formData
                }));
                
                // Update UI
                displayProfileData(formData);
                document.getElementById('userName').textContent = sanitizeHTML(formData.full_name);
                
                showAlert('Profile updated successfully', 'success');
            } catch (error) {
                console.error('Error saving profile:', error);
                
                // For demo mode, just update the UI with form data
                if (window.location.search.includes('demo=true')) {
                    // Update localStorage user
                    const currentUser = JSON.parse(localStorage.getItem('user') || '{}');
                    localStorage.setItem('user', JSON.stringify({
                        ...currentUser,
                        ...formData
                    }));
                    
                    // Update UI
                    displayProfileData(formData);
                    document.getElementById('userName').textContent = sanitizeHTML(formData.full_name);
                    
                    showAlert('Profile updated successfully (Demo Mode)', 'success');
                } else {
                    showAlert('Failed to update profile. Please try again later.', 'error');
                }
            }
        }

        // Reset profile form
        function resetForm() {
            // Reload current profile data
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            displayProfileData(user);
            showAlert('Form reset to original values', 'success');
        }

        // Change password
        async function changePassword() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            // Basic validation
            if (!currentPassword || !newPassword || !confirmPassword) {
                showAlert('Please fill in all password fields', 'error');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showAlert('New passwords do not match', 'error');
                return;
            }
            
            try {
                // In a real app, send to API
                const response = await fetch('http://localhost:8000/api/recruiters/change-password', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${getCookie('token') || localStorage.getItem('token')}`
                    },
                    body: JSON.stringify({
                        current_password: currentPassword,
                        new_password: newPassword
                    })
                });
                
                if (!response.ok) {
                    throw new Error('Failed to change password');
                }
                
                // Reset form
                document.getElementById('accountForm').reset();
                
                showAlert('Password changed successfully', 'success');
            } catch (error) {
                console.error('Error changing password:', error);
                
                // For demo mode, just show success
                if (window.location.search.includes('demo=true')) {
                    document.getElementById('accountForm').reset();
                    showAlert('Password changed successfully (Demo Mode)', 'success');
                } else {
                    showAlert('Failed to change password. Please check your current password and try again.', 'error');
                }
            }
        }

        // Reset password form
        function resetPasswordForm() {
            document.getElementById('accountForm').reset();
            showAlert('Password form reset', 'success');
        }

        // Save notification preferences
        async function saveNotifications() {
            const notifyApplications = document.getElementById('notifyApplications').checked;
            const notifyMessages = document.getElementById('notifyMessages').checked;
            const notifyUpdates = document.getElementById('notifyUpdates').checked;
            
            const preferences = {
                notify_applications: notifyApplications,
                notify_messages: notifyMessages,
                notify_updates: notifyUpdates
            };
            
            try {
                // In a real app, send to API
                const response = await fetch('http://localhost:8000/api/recruiters/notifications', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${getCookie('token') || localStorage.getItem('token')}`
                    },
                    body: JSON.stringify(preferences)
                });
                
                if (!response.ok) {
                    throw new Error('Failed to update notification preferences');
                }
                
                showAlert('Notification preferences saved', 'success');
            } catch (error) {
                console.error('Error saving notification preferences:', error);
                
                // For demo mode, show success
                if (window.location.search.includes('demo=true')) {
                    showAlert('Notification preferences saved (Demo Mode)', 'success');
                } else {
                    showAlert('Failed to save notification preferences. Please try again later.', 'error');
                }
            }
        }

        // Reset notification form
        function resetNotificationsForm() {
            document.getElementById('notifyApplications').checked = true;
            document.getElementById('notifyMessages').checked = true;
            document.getElementById('notifyUpdates').checked = true;
            showAlert('Notification preferences reset', 'success');
        }

        // Settings function
        function showSettings() {
            window.location.href = 'recruiter-profile.html#accountTab';
            showTab('account');
        }

        // Logout
        function logout() {
            // Clear localStorage items
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            localStorage.removeItem('userType');
            localStorage.removeItem('userName');
            
            // Clear cookies by setting expiration to the past
            document.cookie = `token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`;
            
            // Redirect to login page
            window.location.href = 'index.html';
        }

        // Initialize page
        window.addEventListener('load', function() {
            checkAuth();
            
            // Check if URL has a hash for tab
            if (window.location.hash) {
                const tabName = window.location.hash.substring(1).replace('Tab', '');
                showTab(tabName);
            }
        });
    </script>
</body>
</html> 